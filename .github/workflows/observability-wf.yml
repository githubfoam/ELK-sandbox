name: "observability workflow"


on:
  push:
    branches: [ test ]
  # schedule:
  #     - cron:  '0 0 * * 0' #At 00:00 on Sunday every week

jobs:

  ubuntu-2004-virtualenv-job:
    name: "ubuntu-latest virtualenv job"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: "os fingerprinting"
      run: hostnamectl status   
    - name: "build elk-stack"
      working-directory: observability
      run: |
        pip3 install virtualenv
        virtualenv -p $(which python3) ~venvpy3
        source ~venvpy3/bin/activate
        pip install -r requirements.txt 
        virtualenv --version
        sudo docker-compose --file compose.yml up -d
        sudo docker-compose --file compose.yml ps        
        deactivate
    # - name: Docker build
    #   working-directory: observability
    #   run: |
    #     sudo docker-compose --file compose.yml up -d
    #     sudo docker-compose --file compose.yml ps
